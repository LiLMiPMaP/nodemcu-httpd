function resizeHandler(){if(windowWidth=w.outerWidth(),windowHeight=w.outerHeight(),mode){beatWidth=100/noOfBeatsInSequence,beat.each(function(){$(this).css("width",beatWidth+"%")}),circleDiameter=.33*beat.width(),circle.each(function(){$(this).css({height:circleDiameter,width:circleDiameter,top:circleDiameter,left:circleDiameter})});var a=.1*windowHeight,b=.6*a,c=.5*(a-b);sequenceMini.css({left:c,"margin-right":c}),beatMini.css({height:b,top:c,width:b}),bpmValueText.css({"font-size":.05*windowWidth+"px"}),windowWidth<windowHeight?orient.removeClass("hide"):orient.addClass("hide")}else{var d=windowWidth>windowHeight?.6*windowHeight:.6*windowWidth;circleDiameter=.33*d,button.css({width:d,height:d,top:.5*(windowHeight-d),left:.5*(windowWidth-d)}),circle.each(function(){$(this).css({height:circleDiameter,width:circleDiameter,top:circleDiameter,left:circleDiameter})})}var e=.15*windowHeight*.8,f=e/10;icons.css({width:e,height:e,margin:f})}function checkOrientation(){}function step(){if(updateBeats(previousPointer,pointer),0==pointer&&noOfSequences>1&&previousPointer!=-1){var a=activeSequence;sequenceMini.eq(a).removeClass("active"),activeSequence++,activeSequence%=noOfSequences,sequenceMini.eq(activeSequence).addClass("active"),updateSequence(activeSequence)}0==pointer&&""!=ipAddress&&sendRequest(bpmValue,sequenceData[activeSequence].join("")),previousPointer=pointer,pointer=(pointer+1)%8}function updateBeats(a,b){a!=-1&&$("#sequence li:eq( "+a+" )").toggleClass("active"),$("#sequence li:eq( "+b+" )").toggleClass("active")}function updateSequence(a){beat.each(function(){var b=$(this).index();1==sequenceData[a][b]?$(this).addClass("selected"):$(this).removeClass("selected")})}function updateVariables(){sequenceMini=$(".sequence-mini"),beatMini=$(".beat-mini")}function play(a){a?(playButton.children().eq(0).addClass("hide"),playButton.children().eq(1).removeClass("hide"),step(),interval=requestInterval(step,15e3/bpmValue),playStatus=!0,jQuery.data(playButton,"state",playStatus)):(playButton.children().eq(0).removeClass("hide"),playButton.children().eq(1).addClass("hide"),clearRequestInterval(interval),playStatus=!1,jQuery.data(playButton,"state",playStatus))}function sendRequest(a,b,c){"undefined"==typeof c&&(c="40"),"undefined"==typeof b&&(b="1"),"undefined"==typeof a&&(a="200");var d=new XMLHttpRequest;d.open("POST","http://"+ipAddress+"/ss.lc?bpm="+a+"&p="+b+"&ms="+c,!0),d.send("")}function ValidateIPaddress(a){var b=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;return b.test(a)}var mode,circleDiameter,noOfBeatsInSequence=8,beatWidth,lastFillHeight,fillMaxHeight,windowWidth,windowHeight,noOfSequences=1,activeSequence=0,bpmValue=60,speedValue=40,lastBpmValue=bpmValue,interval,playStatus=!1,ipAddress="",ipValid=!1,previousSequence=[],sliding=!1,interval=500,pointer=0,previousPointer=-1,orient,bpm,bpmValueText,speed,speedText,sequence,beat,circle,controls,icons,w,buttonContainer,button,allSequencesContainer,sequenceMini,beatMini,playButton,clearButton,addButton,removeButton,updateIP,changeColour,sequenceData=[[0,0,0,0,0,0,0,0]];$(document).ready(function(){function a(a){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()}mode=void 0!=$("#sequence-mode")[0],w=$(window),orient=$("#orientation-warning"),bpm=$("#bpm-container"),bpmValueText=$("#bpm-value"),speed=$("#speed-container"),speedText=$("#speed-value"),sequence=$("#sequence"),beat=$("#sequence li"),circle=$(".circle"),controls=$("#controls-container"),icons=$(".icon"),buttonContainer=$("#button-container"),button=$("#button"),allSequencesContainer=$("#all-sequences-container"),playButton=$("#play-pause"),addButton=$("#add"),clearButton=$("#clear-all"),removeButton=$("#remove"),updateIP=$("#update-ip"),console.log(updateIP),changeColour=$("#change-colour"),ipAddress=null==localStorage.getItem("ipAddress")?window.location.host:localStorage.getItem("ipAddress"),console.log(ipAddress),jQuery.data(playButton,"state",playStatus),sequenceMiniTemplate=$('<div class="sequence-mini"><div class="beat-mini"></div><div class="beat-mini"></div><div class="beat-mini"></div><div class="beat-mini"></div><div class="beat-mini"></div><div class="beat-mini"></div><div class="beat-mini"></div><div class="beat-mini"></div></div>'),beatMini=sequenceMiniTemplate.find(".beat-mini"),a(document.documentElement),$('input[type="range"]').rangeslider({polyfill:!1,onInit:function(){console.log("loaded")},onSlide:function(a,b){console.log("sliding"),mode?(bpm.css({width:"10%"}),bpmValue=b,bpmValueText.text(b),bpmValueText.addClass("visible").css(b<150?{bottom:"inherit",color:"black"}:{bottom:"0",color:"white"})):(speed.css({width:"10%"}),speedValue=b,speedText.text(b),speedText.addClass("visible").css(b<150?{bottom:"inherit",color:"black"}:{bottom:"0",color:"white"}))},onSlideEnd:function(a,b){console.log("nosliding"),mode?(bpm.css({width:"5%"}),bpmValueText.removeClass("visible"),playStatus&&(play(!1),play(!0)),lastBpmValue=bpmValue):(speed.css({width:"5%"}),speedValueText.removeClass("visible"))}}),$("#switch-UI").hammer().on("tap",function(){window.location.href=mode?"/button.html":"/"});var c=sequenceMiniTemplate.clone();allSequencesContainer.append(c),updateVariables(),sequenceMini.addClass("active"),resizeHandler(),mode?($(window).on("orientationchange",checkOrientation),beat.hammer().on("tap",function(){var a=$(this).index();$(this).toggleClass("selected"),$(".beat-mini:eq("+(8*activeSequence+a)+")").toggleClass("selected"),sequenceData[activeSequence][a]=1==sequenceData[activeSequence][a]?0:1}),addButton.hammer().on("tap",function(){var a=sequenceMini.eq(0).clone().removeClass("active");a.find(".beat-mini").removeClass("selected"),allSequencesContainer.append(a),noOfSequences++,console.log(sequenceData),sequenceData.push([0,0,0,0,0,0,0,0]),updateVariables()}),removeButton.hammer().on("tap",function(){noOfSequences>1&&(noOfSequences-1==activeSequence&&(activeSequence=0,beat.removeClass("selected active"),updateSequence(0),pointer=0,previousPointer=-1,sequenceMini.eq(0).addClass("active")),allSequencesContainer.children().last().remove(),noOfSequences--,sequenceData.pop(),updateVariables())}),playButton.hammer().on("tap",function(){play(playStatus?!1:!0)}),clearButton.hammer().on("tap",function(){if(1==confirm("Nuke it 💣?")){playStatus&&play(!1),noOfSequences=1,activeSequence=0,pointer=0,previousPointer=-1,sequenceData.length=0,sequenceData=[[0,0,0,0,0,0,0,0]];for(var a=allSequencesContainer.children().length,b=a;b>1;b--)allSequencesContainer.children().last().remove();beat.removeClass("selected active"),beatMini.removeClass("selected"),sequenceMini.addClass("active"),updateVariables()}else console.log("no")}),updateIP.hammer({}).on("tap",function(a){var b=prompt("Please enter the IP address of your SoundThing 🍒",""==ipAddress?"":ipAddress),c=ValidateIPaddress(b);console.log(c),null===b?(console.log("canceled"),c=!1):""==b?(alert("You didn't enter anything 😱"),c=!1):c?(ipAddress=b,localStorage.setItem("ipAddress",ipAddress),alert("Awesome! 🤞 and let's try connect to this sucker 😘"),c=!0):(alert('"'+b+'" is not a valid IP address 😥'),c=!1)})):(console.log("button mode"),button.hammer({}).on("tap",function(a){console.log("button pressed"),""!=ipAddress&&sendRequest(),buttonContainer.toggleClass("active"),setTimeout(function(){buttonContainer.toggleClass("active")},50)})),window.addEventListener("resize",resizeHandler,!1)});var requestInterval=function(a,b){function f(){e.value=c(f);var g=(new Date).getTime(),h=g-d;h>=b&&(a.call(),d=(new Date).getTime())}var c=function(){return window.requestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}(),d=(new Date).getTime(),e={};return e.value=c(f),e},clearRequestInterval=function(a){window.cancelAnimationFrame?window.cancelAnimationFrame(a.value):window.clearInterval(a)};