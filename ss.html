<html>
<head>
<script type="text/javascript">

var bpm=119

function play1(ip,p) {
    p = p.replace(/[^ofXx-]/g,'').replace(/-/g,'0').replace(/[^0]/g,'1');
    var url = ip+"/ss.lua?r=5&bpm="+bpm+"&p="+p;
    //console.log(url)
    var xhr = new XMLHttpRequest();
    xhr.open("POST", url);
    xhr.send("");
    return p.length
}

var timeoutid=0;
function play(e) {

    var text = document.getElementById('tab').value;
    var hihat = text.match(/^ C:([-ofXx|]+)/gm);
    var snare = text.match(/^HH:([-ofXx|]+)/gm);
    var bass  = text.match(/^ B:([-ofXx|]+)/gm);

    function play3(p){
        var l1 = play1("http://192.168.100.169", hihat[p]);
        var l2 = play1("http://192.168.100.144", snare[p]);
        var l3 = play1("http://192.168.100.228", bass[p]);
        console.log(l1)
        timeoutid = window.setTimeout(function(){play3(p+1);}, l1*15000/bpm);
    }

    play3(0);
}

function stop(e) {
    play1("http://192.168.100.169", '');
    play1("http://192.168.100.144", '');
    play1("http://192.168.100.228", '');
    window.clearTimeout(timeoutid);
}

function init() {

    document.getElementById('play').addEventListener('click', play);
    document.getElementById('stop').addEventListener('click', stop);
    document.getElementById('bpm').addEventListener('change', function(e) {bpm = e.value;})
}

window.addEventListener('load', init);
</script>
<body>
<p><button id="play">Play!</button><button id="stop">Stop!</button><input type="number" id="bpm" value="119">
</p>
<textarea id="tab" style="height:90vh;width:90vw;font-family: courier">
INTRO
 C:|----------------|
HH:|--o---o---o-----|
 S:|f---f---f---f---|
 B:|-o-o-o-o-o-o--o-|

 C:|X---------------|X---------------|X---------------|X---------------|
HH:|----o---o---o---|----o---o---o---|----o---o---o---|----o---o---o---|
 S:|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|
 B:|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|

 C:|X---------------|X---------------|X---------------|X---------------|
HH:|----o---o---o---|----o---o---o---|----o---o---o---|----o---o-------|
 S:|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|----o-----oooooo|
 B:|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|o--o--o-o-------|

 C:|----------------|----------------|----------------|----------------|
HH:|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-x-o-|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-x-o-|
 S:|----o-------o---|----o-------o---|----o-------o---|----o-------o---|
 B:|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|

VERSE
 C:|----------------|----------------|----------------|----------------|
HH:|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-x-o-|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-x-o-|
 S:|----o-------o---|----o-------o---|----o-------o---|----o-------o---|
 B:|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|

HH:|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-x-o-|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-o---|
 S:|----o-------o---|----o-------o---|----o-------o---|----o-------o---|
 B:|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|

PRE-CHORUS
 C:|X---------------|----------------|X---------------|----------------|
HH:|--o-o-o-o-o-o-o-|o-o-o-o-o-o-o-o-|--o-o-o-o-o-o-o-|o-o-o-o-o-o-o-o-|
 S:|----o-------o---|----o-------o---|----o-------o---|----o-------o---|
 B:|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|

 C:|X---------------|----------------|X---------------|----------------|
HH:|--o-o-o-o-o-o-o-|o-o-o-o-o-o-o-o-|--o-o-o-o-o-o-o-|----------------|
 S:|----o-------o---|----o-------o---|----o-------o---|ooooooooooo-f---|
 B:|o-o---o-o-o---o-|o-o---o-o-o---o-|o-o---o-o-o---o-|o----------o--o-|

CHORUS
 C:|X---------------|X---------------|X---------------|X---------------|
HH:|----o---o---o---|----o---o---o---|----o---o---o---|----o---o---o---|
 S:|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|
 B:|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|

 C:|X---------------|X---------------|X---------------|X---------------|
HH:|----o---o---o---|----o---o---o---|----o---o---o---|----o---o---o---|
 S:|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|
 B:|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|

 C:|X---X---X---X---|X---X---X---X---|X---X---X---X---|X---X---X---X---|
 S:|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|----o---o---o---|
 B:|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|o--o--oo--oo--o-|

 C:|X---------------|X---------------|X---------------|X---------------|
HH:|----o---o-------|----o-----o---o-|----o---o-------|----o---o-------|
 T:|----------------|------------o---|----------------|----------------|
 S:|----o---o-------|----o---f-------|----o---o-------|----o-----oooooo|
FT:|----------------|------------o---|----------------|----------------|
 B:|o-o---oo--o-----|o-o----o-o-o-o-o|o-o---oo--o-----|o-o---o-o-------|

HH:|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-x-o-|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-x-o-|
 S:|----o-------o---|----o-------o---|----o-------o---|----o-------o---|
 B:|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|

VERSE
HH:|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-x-o-|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-x-o-|
 S:|----o-------o---|----o-------o---|----o-------o---|----o-------o---|
 B:|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|

HH:|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-x-o-|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-o---|
 S:|----o-------o---|----o-------o---|----o-------o---|----o-------o---|
 B:|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|

PRE-CHORUS
 C:|X---------------|----------------|X---------------|----------------|
HH:|--o-o-o-o-o-o-o-|o-o-o-o-o-o-o-o-|--o-o-o-o-o-o-o-|o-o-o-o-o-o-o-o-|
 S:|----o-------o---|----o-------o---|----o-------o---|----o-------o---|
 B:|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|

 C:|X---------------|----------------|X---------------|----------------|
HH:|--o-o-o-o-o-o-o-|o-o-o-o-o-o-o-o-|--o-o-o-o-o-o-o-|----------------|
 S:|----o-------o---|----o-------o---|----o-------o---|ooooooooooo-f---|
 B:|o-o---o-o-o---o-|o-o---o-o-o---o-|o-o---o-o-o---o-|o----------o--o-|

CHORUS
 C:|X---------------|X---------------|X---------------|X---------------|
HH:|----o---o---o---|----o---o---o---|----o---o---o---|----o---o---o---|
 S:|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|
 B:|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|

 C:|X---------------|X---------------|X---------------|X---------------|
HH:|----o---o---o---|----o---o---o---|----o---o---o---|----o---o---o---|
 S:|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|
 B:|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|

 C:|X---X---X---X---|X---X---X---X---|X---X---X---X---|X---X---X---X---|
 S:|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|----o---o---o---|
 B:|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|o--o--oo--oo--o-|

 C:|X---------------|X---------------|X---------------|X---------------|
HH:|----o---o-------|----o-----o---o-|----o---o-------|----o---o-------|
 T:|----------------|------------o---|----------------|----------------|
 S:|----o---o-------|----o---f-------|----o---o-------|----o-----oooooo|
FT:|----------------|------------o---|----------------|----------------|
 B:|o-o---oo--o-----|o-o----o-o-o-o-o|o-o---oo--o-----|o-o---o-o-------|

SOLO
 C:|X---------------|----------------|X---------------|X---------------|
HH:|----o---o---o---|o---o---o---o---|----o---o---o---|----o---o---o---|
 S:|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|
 B:|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|

 C:|X---------------|X---------------|X---------------|X---------------|
HH:|----o---o---o---|----o---o---o---|----o---o---o---|----o---o---o---|
 S:|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|
 B:|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|

 C:|X---------------|X---------------|X---------------|X---------------|
HH:|----o---o---o---|----o---o---o---|----o---o---o---|----o---o---o---|
 S:|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|
 B:|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|

 C:|X---------------|X---------------|X---------------|X---------------|
HH:|----o---o---o---|----o---o---o---|----o---o---o---|----o---o-------|
 S:|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|----o--o-ooooooo|
 B:|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-------|

HH:|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-x-o-|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-x-o-|
 S:|----o-------o---|----o-------o---|----o-------o---|----o-------o---|
 B:|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|

VERSE
HH:|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-x-o-|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-x-o-|
 S:|----o-------o---|----o-------o---|----o-------o---|----o-------o---|
 B:|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|

HH:|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-x-o-|x-x-x-x-x-x-x-x-|x-x-x-x-x-x-o---|
 S:|----o-------o---|----o-------o---|----o-------o---|----o-------o---|
 B:|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|

PRE-CHORUS
 C:|X---------------|----------------|X---------------|----------------|
HH:|--o-o-o-o-o-o-o-|o-o-o-o-o-o-o-o-|--o-o-o-o-o-o-o-|o-o-o-o-o-o-o-o-|
 S:|----o-------o---|----o-------o---|----o-------o---|----o-------o---|
 B:|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|o-o-----o-o-----|

 C:|X---------------|----------------|X---------------|----------------|
HH:|--o-o-o-o-o-o-o-|o-o-o-o-o-o-o-o-|--o-o-o-o-o-o-o-|----------------|
 S:|----o-------o---|----o-------o---|----o-------o---|ooooooooooo-f---|
 B:|o-o---o-o-o---o-|o-o---o-o-o---o-|o-o---o-o-o---o-|o----------o--o-|

CHORUS
 C:|X---------------|X---------------|X---------------|X---------------|
HH:|----o---o---o---|----o---o---o---|----o---o---o---|----o---o---o---|
 S:|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|
 B:|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|

 C:|X---------------|X---------------|X---------------|X---------------|
HH:|----o---o---o---|----o---o---o---|----o---o---o---|----o---o---o---|
 S:|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|
 B:|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|

 C:|X---X---X---X---|X---X---X---X---|X---X---X---X---|X---X---X---X---|
 S:|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|----o--o-o--o---|
 B:|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|o--o----o-oo--o-|

OUTRO
 C:|X---X---X---X---|X---X---X---X---|X---X---X---X---|X---X---X---X---|
 S:|----o---o---o---|----o---o---o---|----o---o---o---|----o---o---o---|
 B:|o--o---o-o-o--o-|o--o---o-o-o--o-|o--o---o-o-o--o-|o--o---o-o-o--o-|

 C:|X---X---X---X---|X---X---X---X---|X---X---X---X---|X---X---X-------|
 S:|----o---o---o---|----o---o---o---|----o---o---o---|----o---o---f---|
 B:|o--o---o-o-o--o-|o--o---o-o-o--o-|o--o---o-o-o--o-|o--o---o-o-o--o-|

 C:|X---------------|
 B:|o---------------|
</textarea>
</body>
</html>